---
id: 9d8d9a8a
title: "[P1] LSP config: replace JSON.parse with hand-rolled JSONC parser"
tags: [lsp, p1, bug]
status: open
created_at: "2026-02-15T21:59:47.181Z"
assigned_to_session: fe57f335-3b76-4e39-b491-e689380c3f6b
---

**File:** `agents/extensions/lsp/config.ts`\n\n## Problem\n\n`.zed/settings.json` is JSONC (comments + trailing commas). `JSON.parse` throws on those, so the Zed fallback path is effectively dead for most real configs. The error is caught and logged to stderr (which the user never sees), then `loadConfig` returns `null`.\n\n## Solution\n\nHand-roll a `parseJsonc(text: string)` utility function (~30 lines, zero deps):\n\n- Strip `//` line comments\n- Strip `/* */` block comments\n- Strip trailing commas before `]` or `}`\n- Respect string literals (don't modify contents inside `\"...\"`)\n- Feed cleaned string to `JSON.parse`\n\nApply to **both** parse sites:\n- `.pi/lsp.json` (line ~60) â€” comments are useful here too\n- `.zed/settings.json` (line ~70)\n\n## Constraints\n\n- **No npm dependencies.** This is a dotfiles repo distributed across macOS, Linux, and potentially WSL.\n- Keep it simple and testable.\n
