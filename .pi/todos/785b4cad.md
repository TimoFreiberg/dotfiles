---
id: 785b4cad
title: "[P2] LSP extension: module-level cwd only updated on lsp tool execution"
tags: [lsp, p2, bug]
status: done
created_at: "2026-02-15T21:59:47.185Z"
---

**Fixed in:** `e6facf4c` â€” `fix(lsp): use ctx.cwd instead of cached module-level cwd in tool_result handler`

**Root cause:** The `tool_result` handler resolved file paths against a module-level `cwd` variable that was only updated when the `lsp` tool itself executed. If `write`/`edit` fired before any `lsp` call, it used the stale `process.cwd()` from load time.

**Fix:** 
- Accept the `ctx` parameter in the `tool_result` handler and use `ctx.cwd` directly.
- Remove the module-level `cwd` variable entirely (no remaining uses).
- Remove the `cwd = projectRoot` assignment in `execute()`.
