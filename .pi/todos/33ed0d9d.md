---
id: 33ed0d9d
title: "LSP: Handle server-to-client requests (registerCapability, etc.)"
tags: [important, lsp]
status: open
created_at: "2026-02-18T19:13:05.962Z"
---

**Important** — The `onData` handler in `client.ts` only processes responses to pending requests. Many LSP servers (especially rust-analyzer) send client requests like `client/registerCapability`, `window/workDoneProgress/create`, and `workspace/configuration` that **expect a response**. Not responding can cause the server to hang or degrade.

**Fix:** In the `onData` message parsing, detect incoming requests (have `id` + `method` but aren't in `pending`) and respond with an empty result:
```typescript
if ("id" in msg && "method" in msg) {
  // Server-to-client request — acknowledge
  this.send({ jsonrpc: "2.0", id: msg.id, result: null });
}
```
