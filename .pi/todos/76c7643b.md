---
id: 76c7643b
title: "LSP: Config loaded once and never refreshed during session"
tags: [important, lsp]
status: open
created_at: "2026-02-18T19:13:11.342Z"
---

### Problem
The `configLoaded` flag in `index.ts` caches the LSP config for the entire session. If the user edits `.pi/lsp.json` (or the `.zed/settings.json` fallback) mid-session, changes aren't picked up without restarting pi.

### Scope
Only the two config sources: `.pi/lsp.json` and `.zed/settings.json` (fallback).

### Solution
- **mtime check on every tool invocation:** Before returning cached config, stat the active config file. If mtime is newer than last load, reload and re-cache.
- **Full reload on error/cache miss:** If an LSP operation fails or there's no cached config, force a reload regardless of mtime.

### Changed-config behavior
- **No automatic server restart or teardown.** If the reloaded config differs from what running servers were started with, surface an error telling the user the config has changed and they should `/reload` to pick it up.
- **Invalid config (bad JSON / schema error):** Keep the last good config, but surface a different error message explaining the config file is broken.

### Acceptance criteria
- Existing LSP tests keep passing (don't break things).
- Config file changes are detected via mtime and trigger a reload.
- User sees a clear error when config changed under running servers or when config is invalid.
