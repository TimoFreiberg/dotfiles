---
id: d8510fe5
title: "LSP: `stop()` kills process immediately after exit notification"
tags: [minor, lsp]
status: open
created_at: "2026-02-18T19:13:24.340Z"
---

**Minor** â€” In `client.ts`, `stop()` does:
```typescript
await this.request("shutdown", null);
this.notify("exit", null);
this.proc?.kill();
```

Per LSP spec, the server should exit after receiving the `exit` notification. Calling `kill()` immediately can SIGTERM the server before it handles the exit notification cleanly.

**Fix:** Give the server a moment to exit gracefully:
```typescript
await this.request("shutdown", null);
this.notify("exit", null);
await new Promise(resolve => {
  const timeout = setTimeout(() => { this.proc?.kill(); resolve(null); }, 2000);
  this.proc?.on("exit", () => { clearTimeout(timeout); resolve(null); });
});
```
