---
id: e958f2be
title: "Subagent extension: model ID mapping by provider"
tags: [extension, subagent]
status: open
created_at: "2026-02-18T20:00:50.073Z"
---

## Problem

Agent `.md` files use bare model names (e.g. `claude-opus-4-6`) which aren't valid IDs for any provider. The parent session uses fully-qualified IDs like `global.anthropic.claude-opus-4-6-v1` (bedrock). Subagents fail to start because `pi` can't resolve the short names.

## Solution

Add a simple model mapping layer in the subagent extension that:

1. **Defines two tiers** in agent frontmatter (keep configs simple):
   - `model: opus` → expensive tier (opus 4.6)
   - `model: sonnet` → cheap tier (sonnet 4.6)

2. **Maps tiers to provider-specific IDs** based on detecting the current provider:
   - **Bedrock** (parent model contains `anthropic.claude`):
     - opus → `global.anthropic.claude-opus-4-6-v1`
     - sonnet → `global.anthropic.claude-sonnet-4-6-v1`
   - **Anthropic** (default/fallback):
     - opus → `claude-opus-4-6`
     - sonnet → `claude-sonnet-4-6`

3. **Fallback on failure:** If a subagent fails with a model API error, retry once using the parent session's exact model.

## Agent assignments

- scout → `sonnet` (cheap)
- planner, reviewer, worker → `opus` (expensive)

## Where to change

- `extensions/subagent/index.ts` — resolve mapped model before spawning, detect provider from parent model, add retry-on-model-failure logic
- `agents/*.md` — simplify `model:` frontmatter to `opus` / `sonnet`

## Open questions

- **Detecting the parent model:** Needs investigation — check how the extension API exposes the current session's model string.

## Test

Manual smoke test — invoke a single subagent and confirm it starts successfully on both tiers.

## Notes

- Sonnet 4.6 is brand new; the bedrock ID (`global.anthropic.claude-sonnet-4-6-v1`) is a guess based on the opus pattern. May need adjustment.
