#!/bin/sh
# List TODOs from .todos/ directory in the current repo
set -e

todos_dir=".todos"

if [ ! -d "$todos_dir" ]; then
    echo "No .todos/ directory"
    exit 0
fi

count=0
for f in "$todos_dir"/*.md; do
    [ -e "$f" ] || continue
    slug=$(basename "$f" .md)
    title=""
    created=""
    while IFS= read -r line; do
        case "$line" in
            "# "*)  title="${line#\# }"; break ;;
            created:*) created="${line#created: }" ;;
        esac
    done < "$f"
    if [ -n "$created" ]; then
        printf "  %s (%s) — %s\n" "$slug" "$created" "$title"
    else
        printf "  %s — %s\n" "$slug" "$title"
    fi
    count=$((count + 1))
done

if [ "$count" -eq 0 ]; then
    echo "No TODOs"
fi
